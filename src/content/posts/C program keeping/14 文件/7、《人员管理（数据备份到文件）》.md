## [1. 编译注意选项](https://doc.itprojects.cn/0004.zhishi.c/0002.doc/index.html#/13.1.personmanagesys?id=_1-%e7%bc%96%e8%af%91%e6%b3%a8%e6%84%8f%e9%80%89%e9%a1%b9)

![[_attachments/Pasted image 20250114145127.png]]

## [2. 源代码](https://doc.itprojects.cn/0004.zhishi.c/0002.doc/index.html#/13.1.personmanagesys?id=_2-%e6%ba%90%e4%bb%a3%e7%a0%81)

`main.c`代码如下：

```c
#include <stdio.h>

#include "menu.h"
#include "link.h"
#include "file.h"

int main() {
    // 定义变量，用来存储链表的头
    struct stu *head = NULL;

    // 0. 从文件中恢复之前的数据
    read_all_info_from_file(&head);

    // 1. 打印菜单
    print_menu();

    // 2. 选择功能
    int option = 0;
    while (1) {
        printf("请输入要执行的功能: ");
        scanf("%d", &option);
        switch (option) {
            case 1:
                add_new_student(&head);
                break;
            case 2:
                modify_student(head);
                break;
            case 3:
                search_student(head);
                break;
            case 4:
                delete_student(&head);
                break;
            case 5:
                print_all_stu(head);
                break;
            case 6:
                write_all_info_to_file(head);  // 保存所有数据到文件中
                free_link(head);  // 释放整个链表
                return 0;
            default:
                printf("输入有误，请重新输入...\n");
        }
    }

    return 0;
}
```

`file.c`代码如下：

```c
//
// Created by wangmingdong on 2023/6/13.
//

#include "stdio.h"
#include "custom.h"


void read_all_info_from_file(struct stu **head) {
    // 定义文件指针变量
    FILE *file = fopen("stu.txt", "rb+");
    if (file == NULL) {
        printf("打开文件失败...\n");
        return;
    }

    // 从文件中读取所有的信息
    int read_num = 0;
    struct stu new_stu_temp;
    while ((read_num = fread(&new_stu_temp, sizeof(struct stu), 1, file)) > 0) {
#if DEBUG == 1
        printf("-------- 获取1个用户信息，学号:%d--------\n", new_stu_temp.num);
#endif
        // 创建1个新空间，用来存放信息
        struct stu *new_stu = (struct stu *) malloc(sizeof(struct stu));

        // 给这个新空间中 写入新的数据
        new_stu->num = new_stu_temp.num;
        new_stu->next = NULL;

        // 添加新学生到原链表的末尾
        if (*head == NULL) {
            *head = new_stu;
        } else {
            // 找到链表中，最后1个元素，然后将新的学生添加到模块
            struct stu *p = *head;
            while (p->next != NULL) {
                p = p->next;
            }
            p->next = new_stu;
        }
    }

    // 最后关闭文件
    fclose(file);
}


void write_all_info_to_file(struct stu *head) {
    // 定义文件指针变量
    FILE *file = fopen("stu.txt", "wb");
    if (file == NULL) {
        printf("创建文件失败...");
        return;
    }

    // 向文件写入所有的链表节点信息
    while (head != NULL) {
        fwrite(head, sizeof(struct stu), 1, file);
        head = head->next;
    }

    // 关闭文件
    fclose(file);
}
```

`file.h`代码如下：

```c
//
// Created by wangmingdong on 2023/6/13.
//

#ifndef C_PROJECT10_FILE_H
#define C_PROJECT10_FILE_H

#include "custom.h"

void read_all_info_from_file(struct stu **head);
void write_all_info_to_file(struct stu *head);

#endif //C_PROJECT10_FILE_H
```

`custom.h`代码如下：

```c
//
// Created by wangmingdong on 2023/6/12.
//

#ifndef C_PROJECT10_CUSTOM_H
#define C_PROJECT10_CUSTOM_H

#define DEBUG 1

struct stu {
    int num;
    struct stu *next;
};

#endif //C_PROJECT10_CUSTOM_H
```

`link.c`代码如下：

```c
//
// Created by wangmingdong on 2023/6/12.
//
#include <stdio.h>
#include <stdlib.h>

#include "link.h"

void add_new_student(struct stu **head) {
    // 创建1个新空间，用来存放学生的信息
    struct stu *new_stu = (struct stu *) malloc(sizeof(struct stu));

    // 给这个新空间中 写入新的数据
    printf("请输入新学生的学号:");
    scanf("%d", &(new_stu->num));
    new_stu->next = NULL;

    // 添加新学生到原链表的末尾
    if (*head == NULL) {
        *head = new_stu;
    } else {
        // 找到链表中，最后1个元素，然后将新的学生添加到模块
        struct stu *p = *head;
        while (p->next != NULL) {
            p = p->next;
        }
        p->next = new_stu;
    }
}

void print_all_stu(struct stu *head) {
    while (head != NULL) {
        printf("学生学号:%d\n", head->num);
        head = head->next;
    }
}

void modify_student(struct stu *head) {
    printf("请输入要修改的学生学号:");
    int num;
    scanf("%d", &num);

    // 遍历链表，查询是否存在这个学生学号
    int new_num;
    int flag = 0;
    while (head != NULL) {
        if (head->num == num) {
            // 找到需要修改的学生
            printf("OK，已找到学号%d, 请输入新的学生学号:", num);
            scanf("%d", &new_num);
            head->num = new_num;
            flag = 1;  // 用1标示已找到，用0标示未找到
            break;
        }

        head = head->next;
    }

    if (flag == 0) {
        printf("SORRY, 没有找到学号%d\n", num);
    }
}

void search_student(struct stu *head) {
    printf("请输入要查询的学生学号:");
    int num;
    scanf("%d", &num);

    // 遍历链表，查询是否存在这个学生学号
    int flag = 0;
    while (head != NULL) {
        if (head->num == num) {
            // 找到需要修改的学生
            printf("OK，已找到学号%d\n", num);
            flag = 1;  // 用1标示已找到，用0标示未找到
            break;
        }

        head = head->next;
    }

    if (flag == 0) {
        printf("SORRY, 没有找到学号%d\n", num);
    }
}

void delete_student(struct stu **head) {
    printf("请输入要删除的学生学号:");
    int num;
    scanf("%d", &num);

    // 遍历链表，查询是否存在这个学生学号
    int flag = 0;
    struct stu *p1, *p2 = NULL;
    p1 = *head;

    while (p1 != NULL) {
        if (p1->num == num) {
            // 找到需要删除的学生
            printf("OK，已找到学号%d\n", num);
            flag = 1;  // 用1标示已找到，用0标示未找到

            // 如果要删除的是 第1个节点
            if (p1 == *head) {
                *head = p1->next;
            } else {
                p2->next = p1->next;
            }

            // 注意，要将malloc的内存空间，释放
            free(p1);

            break;
        }

        p2 = p1;
        p1 = p1->next;
    }

    if (flag == 0) {
        printf("SORRY, 没有找到要删除的学号%d\n", num);
    }
}

void free_link(struct stu *head) {
    struct stu *temp;
    while (head != NULL) {
        temp = head;
        head = head->next;
        free(temp);
    }
}
```

`link.h`代码如下：

```c
//
// Created by wangmingdong on 2023/6/12.
//

#ifndef C_PROJECT10_LINK_H
#define C_PROJECT10_LINK_H

#include "custom.h"

// 对.c中的6个函数进行声明
void add_new_student(struct stu **head);
void print_all_stu(struct stu *head);
void modify_student(struct stu *head);
void search_student(struct stu *head);
void delete_student(struct stu **head);
void free_link(struct stu *head);


#endif //C_PROJECT10_LINK_H
```

`link.c`代码如下：

```c
//
// Created by wangmingdong on 2023/6/12.
//
#include <stdio.h>

// 函数的定义
void print_menu() {
    printf("-------------菜单------------\n");
    printf("1. 添加新学生信息\n");
    printf("2. 修改学生信息\n");
    printf("3. 查询学生信息\n");
    printf("4. 删除学生信息\n");
    printf("5. 打印所有学生信息\n");
    printf("6. 退出系统\n");
    printf("----------------------------\n");
}
```

`link.h`代码如下：

```c
//
// Created by wangmingdong on 2023/6/12.
//

#ifndef C_PROJECT10_MENU_H
#define C_PROJECT10_MENU_H

// 函数的声明
void print_menu();

#endif //C_PROJECT10_MENU_H
```

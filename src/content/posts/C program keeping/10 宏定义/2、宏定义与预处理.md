## [1. 程序的编译过程](https://doc.itprojects.cn/0004.zhishi.c/0002.doc/index.html#/10.3.define?id=_1-%e7%a8%8b%e5%ba%8f%e7%9a%84%e7%bc%96%e8%af%91%e8%bf%87%e7%a8%8b)

![[_attachments/Pasted image 20250114144025.png]]![[_attachments/Pasted image 20250114144031.png]]

#### [预处理（预编译）](https://doc.itprojects.cn/0004.zhishi.c/0002.doc/index.html#/10.3.define?id=%e9%a2%84%e5%a4%84%e7%90%86%ef%bc%88%e9%a2%84%e7%bc%96%e8%af%91%ef%bc%89)

源代码在编译成机器指令之前要进行预处理

预处理阶段可以根据预处理指令，(以`#`开头)执行 一些列操作

预处理可以在编译之前处理及修改`C` 源代码

完成预处理阶段，并分析及执行了所有的预处理指令之后，这些指令就不再出现在源代码中

如`#include` 和 `#define` 指令

#### [替换程序代码](https://doc.itprojects.cn/0004.zhishi.c/0002.doc/index.html#/10.3.define?id=%e6%9b%bf%e6%8d%a2%e7%a8%8b%e5%ba%8f%e4%bb%a3%e7%a0%81)

程序在编译之前，预处理器指令会替换源代码中的符号

最简单的符号替换前面已经介绍过，例如使用预处理器指令将字符串`PI`替换为特定值:

```
#define PI 3.14159265;
```

标示符`PI` 看起来像变量，但是它不是变量，与变量一点关系也没有，`PI` 是一个标志，作用在预处理阶段用来替换在`#define`指令中指定的一串数字。当预处理完成后，准备编译程序时，PI字符串已经被它的定义取代，不再出现了

```
printf("%f", PI);
```

## [2. 宏的概念](https://doc.itprojects.cn/0004.zhishi.c/0002.doc/index.html#/10.3.define?id=_2-%e5%ae%8f%e7%9a%84%e6%a6%82%e5%bf%b5)

宏基于前面的`#define`指令，但它的适用范围比较大，不仅可以使用固定的字符串代替某些代码，可以可以进行参数化的代换，这个代换也叫宏展开或者宏代换

C语言中“宏”可以分为2种类型

- 无参数宏
- 有参数宏

二者在定义时的一般形式为：

![[_attachments/Pasted image 20250114144043.png]]

### [2.1 无参宏](https://doc.itprojects.cn/0004.zhishi.c/0002.doc/index.html#/10.3.define?id=_21-%e6%97%a0%e5%8f%82%e5%ae%8f)

```
#define PI 3.14
```

假如程序中是使用某个数值多次，当需要修改的时候，需要花费很大的力气去进行修改；但是如果采用宏则很方便的解决这个问题

无参宏使用注意事项

- 习惯上宏名也是标示符，建议用`大写字母`表示，以便与变量区别
- 字符串可以是常量，表达式，格式串，数据类型等，无论写什么都会原封不动的替换掉
- 无分号，宏定义是指令，所以末尾不加分号定义位置

作用域：

- 定义必须写在函数外面，作用域为宏定义命令到源程序结束
- 终止作用域可以使用`#undef`命令
- 宏可以嵌套定义

### [2.2 有参宏](https://doc.itprojects.cn/0004.zhishi.c/0002.doc/index.html#/10.3.define?id=_22-%e6%9c%89%e5%8f%82%e5%ae%8f)

![[_attachments/Pasted image 20250114144049.png]]

有参宏使用注意事项

- 定义符合规范 : 形参之间可以出现空格，但是宏名和形参表之间不能有空格出现
- 形参只是简单的符号代换，不需要分配内存空间，不存在值传递问题
- 通常加括号`( )`利于代码的可读性
- 字符串可以放多个语句

示例：

![[_attachments/Pasted image 20250114144059.png]]

## [3. `#typedef`和`#define`的区别](https://doc.itprojects.cn/0004.zhishi.c/0002.doc/index.html#/10.3.define?id=_3-typedef%e5%92%8cdefine%e7%9a%84%e5%8c%ba%e5%88%ab)

宏定义：只是简单的字符串代换，在预处理阶段完成

typedef：对类型说明符起一个别名，在编译的时候处理，用来表示新命名的标示符具有类型定义说明的功能
